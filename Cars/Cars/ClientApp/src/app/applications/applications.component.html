<div class="card mb-4 box-shadow container-lg p-0">
  <h1 *ngIf="!recruitmentApplications || !details else loaded"></h1>

  <ng-template #loaded>


    <div class="card-header">
      <h4 class="my-0 font-weight-normal">Aplikacje</h4>
    </div>


    <div class="card-body">
      <div class="col-auto">
        <h5 *ngIf="details.status==1" class="alert alert-warning">Rekrutacja zamknięta</h5>

        <button [routerLink]="['/recruitment-settings/' + id]" class="btn btn-warning me-5">Edycja rekrutacji</button>
        <button [routerLink]="['/recruitment-details/' + id]" class="btn btn-primary me-5">Pogląd rekrutacji</button>

        <button (click)="selectCandidates()" *ngIf="details.status!=1" class="btn btn-success">
          Wybierz kandydatów i zakończ rekrutację
        </button>

      </div>

      <h1 *ngIf="recruitmentApplications.length == 0 else any">Brak aplikacji</h1>

      <ng-template #any>
        <section class="row py-3">
          <h6 class="col">Ilość aplikacji: {{recruitmentApplications.length}}</h6>
        </section>

        <section class="me-1">
          <div class="row">
            <h5 [appSort]="recruitmentApplications" class="col-4 border-end border-dark th-sm search"
                data-name="applicant.name">Lista aplikacji</h5>
            <p [appSort]="recruitmentApplications" class="col-1 border-end border-dark search" data-name="codeOverallQuality.bugs"
               data-order="desc">Błędy</p>
            <p [appSort]="recruitmentApplications" class="col-1 border-end border-dark search" data-name="codeOverallQuality.securityRating"
               data-order="desc">Bezpieczeństwo</p>
            <p [appSort]="recruitmentApplications" class="col-1 border-end border-dark search" data-name="codeOverallQuality.codeSmells"
               data-order="desc">Code Smells</p>
            <p [appSort]="recruitmentApplications" class="col-1 border-end border-dark search" data-name="codeOverallQuality.duplicatedLinesDensity"
               data-order="desc">Powtórzenia (%)</p>
            <p [appSort]="recruitmentApplications" class="col-1 border-end border-dark search" data-name="codeOverallQuality.reliabilityRating"
               data-order="desc">Niezawodność</p>
            <p [appSort]="recruitmentApplications" class="col-1 border-end border-dark search" data-name="codeOverallQuality.maintainabilityRating"
               data-order="desc">Utrzymywalność</p>
            <p [appSort]="recruitmentApplications" class="col-1 border-end border-dark search" data-name="codeOverallQuality.technicalDebt"
               data-order="desc">Dług techniczny</p>
            <p [appSort]="recruitmentApplications" class="col-1 search" data-name="codeOverallQuality.overallRating"
               data-order="desc">Ogólna ocena</p>
          </div>

          <div class="row">

            <mat-card *ngFor="let application of recruitmentApplications"
                      class="mb-1 {{application.selected ? 'selected' : 'base'}}">
              <div class="row">
                <div class="col-2">
                  <img [src]="authorizeService.createImgPath(application.applicant.profilePicture)"
                       alt="Thumbnail image"
                       class="img-fluid">
                  <p class="mt-2"> {{application.time | date: 'dd-MM-yyyy HH:mm'}}</p>
                </div>

                <div class="col-2 border-end border-dark">
                  <h5 class="card-title">{{application.applicant.name}}</h5>
                  <p>{{application.description}}</p>

                  <app-application-details [details]="application"></app-application-details>

                  <div class="form-check pt-2">
                    <input [(ngModel)]="application.selected" [disabled]="details.status == 1"
                           class="form-check-input"
                           id="flexSelected{{application.id}}" type="checkbox">
                    <label class="form-check-label" for="flexSelected{{application.id}}">
                      Wybrano
                    </label>
                  </div>
                </div>

                <h3 *ngIf="!application.codeOverallQuality else examined"
                    class="col justify-content-center align-self-center">Projekt nie został jeszcze zbadany</h3>

                <ng-template #examined>
                  <h3
                    *ngIf="!application.codeOverallQuality.success && application.codeOverallQuality.retries > 3 else success"
                    class="col justify-content-center align-self-center">Badanie nie powiodło się</h3>

                  <ng-template #success>
                    <div class="col-1 border-end border-dark text-center">
                      <h5 class="card-title">{{getValue(application.codeOverallQuality.bugs)}}</h5>
                    </div>

                    <div class="col-1 border-end border-dark text-center">
                      <h5
                        class="card-title">{{getValue(application.codeOverallQuality.securityRating)}}</h5>
                    </div>

                    <div class="col-1 border-end border-dark text-center">
                      <h5
                        class="card-title">{{getValue(application.codeOverallQuality.codeSmells)}}</h5>
                    </div>

                    <div class="col-1 border-end border-dark text-center">
                      <h5
                        class="card-title">{{getValue(application.codeOverallQuality.duplicatedLinesDensity)}}</h5>
                    </div>

                    <div class="col-1 border-end border-dark text-center">
                      <h5
                        class="card-title">{{getValue(application.codeOverallQuality.reliabilityRating)}}</h5>
                    </div>

                    <div class="col-1 border-end border-dark text-center">
                      <h5
                        class="card-title">{{getValue(application.codeOverallQuality.maintainabilityRating)}}</h5>
                    </div>

                    <div class="col-1 border-end border-dark text-center">
                      <h5
                        class="card-title">{{getValue(application.codeOverallQuality.technicalDebt)}}</h5>
                    </div>

                    <div class="col-1 text-center">
                      <h5
                        class="card-title">{{getValue(application.codeOverallQuality.overallRating)}}</h5>
                    </div>
                  </ng-template>
                </ng-template>
              </div>
            </mat-card>
          </div>
        </section>

      </ng-template>
    </div>
  </ng-template>
</div>
